<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Ferroelectric Hysteresis Simulation</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; background: #f5f5f5; padding: 20px; }
        h1 { color: #d32f2f; text-align: center; }
        section { background: #fff; padding: 20px; margin: 20px auto; border-radius: 10px; max-width: 900px; box-shadow: 0 2px 8px rgba(0,0,0,0.2); }
        .controls { text-align: center; margin-bottom: 20px; }
        input { width: 80px; margin: 0 10px; }
        #plot { width: 100%; height: 500px; }
    </style>
</head>
<body>

<h1>Ferroelectric P–E Hysteresis Simulation</h1>

<!-- Section: Material Controls -->
<section>
    <h2>Material Parameters</h2>
    <div class="controls">
        <label>Ps (Saturation Polarization): <input type="number" id="Ps" value="1" step="0.1"></label>
        <label>Ec (Coercive Field): <input type="number" id="Ec" value="0.5" step="0.1"></label>
        <button onclick="updatePlot()">Update Plot</button>
    </div>
</section>

<!-- Section: Hysteresis Plot -->
<section>
    <h2>P–E Hysteresis Curve</h2>
    <div id="plot"></div>
</section>

<!-- Section: Observations -->
<section>
    <h2>Key Observations</h2>
    <p id="observations">Adjust parameters and click 'Update Plot' to view remanent polarization.</p>
</section>

<script>
    // Function to calculate polarization
    function polarization(E, Ps, Ec) {
        return E.map(e => Ps * Math.tanh(e / Ec));
    }

    // Generate triangular electric field waveform for hysteresis loop
    function generateE(maxE, pointsPerCycle, cycles=1) {
        let E = [];
        for (let i = 0; i < pointsPerCycle; i++) {
            E.push(-maxE + (4 * maxE * i) / pointsPerCycle);
        }
        let E_full = [];
        for (let c = 0; c < cycles; c++) {
            E_full = E_full.concat(E, E.map(e => -e));
        }
        return E_full;
    }

    // Plot hysteresis loop
    function plotHysteresis(Ps, Ec) {
        let points = 500;
        let maxE = 2 * Ec;
        let E = generateE(maxE, points, 1);
        let P = polarization(E, Ps, Ec);

        // Approximate remanent polarization (Pr) at E ≈ 0
        let PrIndex = E.findIndex(e => Math.abs(e) < 0.01);
        let Pr = P[PrIndex];

        let trace = {
            x: E,
            y: P,
            mode: 'lines',
            line: {color: 'crimson', width: 3},
            name: 'P–E Loop'
        };

        let layout = {
            title: 'Ferroelectric P–E Hysteresis Curve',
            xaxis: {title: 'Electric Field (kV/cm)'},
            yaxis: {title: 'Polarization (C/m²)'},
            shapes: [
                { type: 'line', x0:0, y0:Math.min(...P), x1:0, y1:Math.max(...P), line:{dash:'dash', color:'black'} },
                { type: 'line', x0:Math.min(...E), y0:0, x1:Math.max(...E), y1:0, line:{dash:'dash', color:'black'} }
            ],
            annotations: [
                { x:0, y:Pr, xref:'x', yref:'y', text:`Pr ≈ ${Pr.toFixed(2)}`, showarrow:true, arrowhead:3, ax:40, ay:-40 }
            ]
        };

        Plotly.newPlot('plot', [trace], layout, {responsive: true});

        document.getElementById('observations').innerHTML = 
            `Approximate Remanent Polarization (Pr): ${Pr.toFixed(2)} C/m²`;
    }

    // Initial plot
    plotHysteresis(1, 0.5);

    // Update plot when parameters change
    function updatePlot() {
        let Ps = parseFloat(document.getElementById('Ps').value);
        let Ec = parseFloat(document.getElementById('Ec').value);
        plotHysteresis(Ps, Ec);
    }
</script>

</body>
</html>
